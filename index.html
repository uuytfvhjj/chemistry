<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>群论教学动画 - 物理化学应用</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4a90e2;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #4a90e2;
            font-size: 1.2rem;
            font-weight: normal;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .visualization-section {
            flex: 1;
            min-width: 600px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }
        
        .theory-section {
            flex: 1;
            min-width: 500px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }
        
        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .molecule-container {
            position: relative;
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f9fdff;
            margin-bottom: 20px;
        }
        
        #molecule-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group h3 {
            margin-bottom: 10px;
            color: #4a90e2;
            font-size: 1.2rem;
        }
        
        select, button {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #f9f9f9;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        select:focus, button:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #3a7bc8;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .symmetry-operation {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4a90e2;
        }
        
        .symmetry-operation h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .point-group-examples {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .point-group-card {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d0e3ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .point-group-card:hover {
            background-color: #dbeafe;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .point-group-card.active {
            background-color: #4a90e2;
            color: white;
        }
        
        .point-group-card h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .atom-a { background-color: #FF6B6B; }
        .atom-b { background-color: #4ECDC4; }
        .atom-c { background-color: #FFD166; }
        .atom-d { background-color: #06D6A0; }
        
        .symmetry-element {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9fdff;
            border-radius: 6px;
            border: 1px dashed #4a90e2;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .visualization-section, .theory-section {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>群论教学动画 - 分子对称性与点群</h1>
            <p class="subtitle">物理化学交互式教学工具 | 可视化对称操作与群论概念</p>
        </header>
        
        <div class="main-content">
            <section class="visualization-section">
                <h2 class="section-title">分子模型与对称操作可视化</h2>
                <div class="molecule-container">
                    <canvas id="molecule-canvas"></canvas>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <h3>选择点群</h3>
                        <select id="point-group-select">
                            <option value="C1">C₁群 - 无对称性 (例如: CHFClBr)</option>
                            <option value="C2">C₂群 - 二重旋转轴 (例如: H₂O₂)</option>
                            <option value="C2v" selected>C₂ᵥ群 - 水分子 (H₂O)</option>
                            <option value="C3v">C₃ᵥ群 - 氨分子 (NH₃)</option>
                            <option value="C4v">C₄ᵥ群 - 四氟化氙 (XeF₄)</option>
                            <option value="D2h">D₂ₕ群 - 乙烯 (C₂H₄)</option>
                            <option value="D3h">D₃ₕ群 - 三氟化硼 (BF₃)</option>
                            <option value="D4h">D₄ₕ群 - 正方形平面配合物</option>
                            <option value="Td">T₄群 - 甲烷 (CH₄)</option>
                            <option value="Oh">Oₕ群 - 八面体配合物 (SF₆)</option>
                        </select>
                        
                        <h3>对称操作</h3>
                        <button id="identity-btn">恒等操作 (E)</button>
                        <button id="rotation-btn">旋转操作 (Cₙ)</button>
                        <button id="reflection-btn">反映操作 (σ)</button>
                        <button id="inversion-btn">反演操作 (i)</button>
                        <button id="improper-rotation-btn">旋转反映操作 (Sₙ)</button>
                    </div>
                    
                    <div class="control-group">
                        <h3>操作参数</h3>
                        <select id="axis-select">
                            <option value="z">z轴 (主轴)</option>
                            <option value="x">x轴</option>
                            <option value="y">y轴</option>
                        </select>
                        
                        <select id="angle-select">
                            <option value="60">60° (C₆)</option>
                            <option value="90">90° (C₄)</option>
                            <option value="120" selected>120° (C₃)</option>
                            <option value="180">180° (C₂)</option>
                            <option value="360">360° (C₁)</option>
                        </select>
                        
                        <select id="plane-select">
                            <option value="xy">xy平面 (σₕ)</option>
                            <option value="xz" selected>xz平面 (σᵥ)</option>
                            <option value="yz">yz平面 (σᵥ')</option>
                        </select>
                        
                        <button id="animate-all-btn">完整对称操作序列</button>
                        <button id="reset-btn">重置模型</button>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="color-box atom-a"></div>
                        <span>中心原子</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box atom-b"></div>
                        <span>配位原子类型 A</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box atom-c"></div>
                        <span>配位原子类型 B</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box atom-d"></div>
                        <span>配位原子类型 C</span>
                    </div>
                </div>
            </section>
            
            <section class="theory-section">
                <h2 class="section-title">群论理论解释</h2>
                
                <div class="symmetry-operation">
                    <h4>当前点群: <span id="current-group">C₂ᵥ</span></h4>
                    <p id="group-description">C₂ᵥ点群包含以下对称操作: 恒等操作(E), 绕主轴C₂旋转180°, 两个垂直对称面(σᵥ和σᵥ')。水分子(H₂O)属于C₂ᵥ点群。</p>
                </div>
                
                <div class="symmetry-operation">
                    <h4>群的基本概念</h4>
                    <p>一个数学群(G)由元素的集合和二元运算(通常称为"乘法")构成，满足四个条件:</p>
                    <ol>
                        <li><strong>封闭性:</strong> 群中任意两个元素的乘积仍在群中</li>
                        <li><strong>结合律:</strong> (ab)c = a(bc) 对所有a,b,c ∈ G成立</li>
                        <li><strong>单位元:</strong> 存在元素e使得ea = ae = a 对所有a ∈ G成立</li>
                        <li><strong>逆元:</strong> 对每个a ∈ G存在a⁻¹使得aa⁻¹ = a⁻¹a = e</li>
                    </ol>
                </div>
                
                <div class="symmetry-operation">
                    <h4>对称操作类型</h4>
                    <ul>
                        <li><strong>恒等操作(E):</strong> 不改变分子构型的操作</li>
                        <li><strong>旋转操作(Cₙ):</strong> 绕轴旋转360°/n角度</li>
                        <li><strong>反映操作(σ):</strong> 关于平面的镜像操作</li>
                        <li><strong>反演操作(i):</strong> 通过对称中心的反演</li>
                        <li><strong>旋转反映操作(Sₙ):</strong> 旋转与反映的复合操作</li>
                    </ul>
                </div>
                
                <div class="symmetry-element">
                    <h4>当前对称元素</h4>
                    <p id="symmetry-elements">主轴: C₂轴(z轴) | 对称面: σᵥ(xz平面), σᵥ'(yz平面)</p>
                </div>
                
                <h3 class="section-title">常见点群示例</h3>
                <div class="point-group-examples">
                    <div class="point-group-card" data-group="C1">
                        <h4>C₁</h4>
                        <p>无对称性<br>例: CHFClBr</p>
                    </div>
                    <div class="point-group-card" data-group="C2v">
                        <h4>C₂ᵥ</h4>
                        <p>水分子(H₂O)<br>有C₂轴和2个σᵥ面</p>
                    </div>
                    <div class="point-group-card" data-group="C3v">
                        <h4>C₃ᵥ</h4>
                        <p>氨分子(NH₃)<br>有C₃轴和3个σᵥ面</p>
                    </div>
                    <div class="point-group-card" data-group="Td">
                        <h4>T₄</h4>
                        <p>甲烷(CH₄)<br>正四面体对称</p>
                    </div>
                    <div class="point-group-card" data-group="Oh">
                        <h4>Oₕ</h4>
                        <p>八面体(SF₆)<br>八面体对称</p>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="footer">
            <p>群论教学动画 - 专为物理化学教学设计的交互式工具 | 使用HTML5 Canvas和JavaScript实现</p>
            <p>提示: 点击点群示例卡片可快速切换分子模型，使用控制面板演示不同的对称操作</p>
        </div>
    </div>

    <script>
        // 获取Canvas元素和上下文
        const canvas = document.getElementById('molecule-canvas');
        const ctx = canvas.getContext('2d');
        
        // 设置Canvas尺寸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // 初始调整尺寸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // 分子模型定义
        let molecule = {
            atoms: [],
            bonds: [],
            symmetryElements: {
                rotationAxes: [],
                mirrorPlanes: [],
                inversionCenter: false
            }
        };
        
        // 点群定义和对应的分子结构
        const pointGroups = {
            'C1': {
                name: 'C₁',
                description: 'C₁点群仅包含恒等操作(E)，分子无任何对称性。例如不对称分子CHFClBr。',
                atoms: [
                    {type: 'C', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'F', x: 1.0, y: 0.5, z: 0.3, color: '#4ECDC4'},
                    {type: 'Cl', x: -0.8, y: 0.7, z: -0.4, color: '#FFD166'},
                    {type: 'Br', x: 0.3, y: -0.9, z: 0.5, color: '#06D6A0'},
                    {type: 'H', x: -0.5, y: -0.3, z: 0.9, color: '#A0A0A0'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 0, a2: 3},
                    {a1: 0, a2: 4}
                ],
                symmetryElements: {
                    rotationAxes: [],
                    mirrorPlanes: [],
                    inversionCenter: false
                }
            },
            'C2': {
                name: 'C₂',
                description: 'C₂点群包含恒等操作(E)和绕C₂轴旋转180°的操作。例如过氧化氢(H₂O₂)分子。',
                atoms: [
                    {type: 'O', x: 0, y: 0.5, z: 0, color: '#FF6B6B'},
                    {type: 'O', x: 0, y: -0.5, z: 0, color: '#FF6B6B'},
                    {type: 'H', x: 0.8, y: 0.7, z: 0, color: '#A0A0A0'},
                    {type: 'H', x: -0.8, y: -0.7, z: 0, color: '#A0A0A0'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 1, a2: 3}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'z', n: 2}],
                    mirrorPlanes: [],
                    inversionCenter: false
                }
            },
            'C2v': {
                name: 'C₂ᵥ',
                description: 'C₂ᵥ点群包含以下对称操作: 恒等操作(E), 绕主轴C₂旋转180°, 两个垂直对称面(σᵥ和σᵥ\')。水分子(H₂O)属于C₂ᵥ点群。',
                atoms: [
                    {type: 'O', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'H', x: 0.8, y: 0.5, z: 0, color: '#4ECDC4'},
                    {type: 'H', x: -0.8, y: 0.5, z: 0, color: '#4ECDC4'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'z', n: 2}],
                    mirrorPlanes: [{plane: 'xz'}, {plane: 'yz'}],
                    inversionCenter: false
                }
            },
            'C3v': {
                name: 'C₃ᵥ',
                description: 'C₃ᵥ点群包含恒等操作(E), 绕C₃轴旋转120°和240°, 以及三个垂直对称面(σᵥ)。氨分子(NH₃)属于C₃ᵥ点群。',
                atoms: [
                    {type: 'N', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'H', x: 0.8, y: 0, z: 0, color: '#4ECDC4'},
                    {type: 'H', x: -0.4, y: 0.693, z: 0, color: '#4ECDC4'},
                    {type: 'H', x: -0.4, y: -0.693, z: 0, color: '#4ECDC4'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 0, a2: 3}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'z', n: 3}],
                    mirrorPlanes: [{plane: 'xz'}, {plane: 'plane1'}, {plane: 'plane2'}],
                    inversionCenter: false
                }
            },
            'C4v': {
                name: 'C₄ᵥ',
                description: 'C₄ᵥ点群包含恒等操作(E), 绕C₄轴旋转90°, 180°, 270°, 以及四个垂直对称面。四氟化氙(XeF₄)属于C₄ᵥ点群。',
                atoms: [
                    {type: 'Xe', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'F', x: 1.0, y: 0, z: 0, color: '#4ECDC4'},
                    {type: 'F', x: -1.0, y: 0, z: 0, color: '#4ECDC4'},
                    {type: 'F', x: 0, y: 1.0, z: 0, color: '#FFD166'},
                    {type: 'F', x: 0, y: -1.0, z: 0, color: '#FFD166'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 0, a2: 3},
                    {a1: 0, a2: 4}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'z', n: 4}],
                    mirrorPlanes: [{plane: 'xz'}, {plane: 'yz'}, {plane: 'diag1'}, {plane: 'diag2'}],
                    inversionCenter: false
                }
            },
            'Td': {
                name: 'T₄',
                description: 'T₄点群是正四面体的对称群，包含24个对称操作。甲烷(CH₄)分子属于T₄点群。',
                atoms: [
                    {type: 'C', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'H', x: 0.63, y: 0.63, z: 0.63, color: '#4ECDC4'},
                    {type: 'H', x: -0.63, y: -0.63, z: 0.63, color: '#4ECDC4'},
                    {type: 'H', x: -0.63, y: 0.63, z: -0.63, color: '#FFD166'},
                    {type: 'H', x: 0.63, y: -0.63, z: -0.63, color: '#06D6A0'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 0, a2: 3},
                    {a1: 0, a2: 4}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'x', n: 2}, {axis: 'y', n: 2}, {axis: 'z', n: 2}, {axis: '111', n: 3}],
                    mirrorPlanes: [{plane: 'xy'}, {plane: 'xz'}, {plane: 'yz'}, {plane: 'diag'}],
                    inversionCenter: false
                }
            },
            'Oh': {
                name: 'Oₕ',
                description: 'Oₕ点群是正八面体的对称群，包含48个对称操作。六氟化硫(SF₆)分子属于Oₕ点群。',
                atoms: [
                    {type: 'S', x: 0, y: 0, z: 0, color: '#FF6B6B'},
                    {type: 'F', x: 1.0, y: 0, z: 0, color: '#4ECDC4'},
                    {type: 'F', x: -1.0, y: 0, z: 0, color: '#4ECDC4'},
                    {type: 'F', x: 0, y: 1.0, z: 0, color: '#FFD166'},
                    {type: 'F', x: 0, y: -1.0, z: 0, color: '#FFD166'},
                    {type: 'F', x: 0, y: 0, z: 1.0, color: '#06D6A0'},
                    {type: 'F', x: 0, y: 0, z: -1.0, color: '#A0A0A0'}
                ],
                bonds: [
                    {a1: 0, a2: 1},
                    {a1: 0, a2: 2},
                    {a1: 0, a2: 3},
                    {a1: 0, a2: 4},
                    {a1: 0, a2: 5},
                    {a1: 0, a2: 6}
                ],
                symmetryElements: {
                    rotationAxes: [{axis: 'x', n: 4}, {axis: 'y', n: 4}, {axis: 'z', n: 4}, {axis: '111', n: 3}],
                    mirrorPlanes: [{plane: 'xy'}, {plane: 'xz'}, {plane: 'yz'}, {plane: 'diag'}],
                    inversionCenter: true
                }
            }
        };
        
        // 当前状态
        let currentGroup = 'C2v';
        let animationActive = false;
        let originalAtoms = [];
        
        // 初始化分子
        function initMolecule(groupId) {
            const group = pointGroups[groupId];
            if (!group) return;
            
            currentGroup = groupId;
            molecule.atoms = JSON.parse(JSON.stringify(group.atoms));
            molecule.bonds = JSON.parse(JSON.stringify(group.bonds));
            molecule.symmetryElements = JSON.parse(JSON.stringify(group.symmetryElements));
            originalAtoms = JSON.parse(JSON.stringify(group.atoms));
            
            // 更新UI
            document.getElementById('current-group').textContent = group.name;
            document.getElementById('group-description').textContent = group.description;
            
            // 更新对称元素显示
            let symmetryText = '';
            if (molecule.symmetryElements.rotationAxes.length > 0) {
                symmetryText += '主轴: ';
                molecule.symmetryElements.rotationAxes.forEach(axis => {
                    symmetryText += `C${axis.n}轴(${axis.axis}轴) `;
                });
                symmetryText += '| ';
            }
            
            if (molecule.symmetryElements.mirrorPlanes.length > 0) {
                symmetryText += '对称面: ';
                molecule.symmetryElements.mirrorPlanes.forEach(plane => {
                    symmetryText += `σ(${plane.plane}) `;
                });
                symmetryText += '| ';
            }
            
            if (molecule.symmetryElements.inversionCenter) {
                symmetryText += '对称中心: i';
            }
            
            document.getElementById('symmetry-elements').textContent = symmetryText || '无对称元素';
            
            // 更新点群选择器
            document.getElementById('point-group-select').value = groupId;
            
            // 更新点群卡片激活状态
            document.querySelectorAll('.point-group-card').forEach(card => {
                if (card.dataset.group === groupId) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            drawMolecule();
        }
        
        // 绘制分子
        function drawMolecule() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 设置投影参数
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = Math.min(canvas.width, canvas.height) / 5;
            
            // 绘制键
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#333';
            
            molecule.bonds.forEach(bond => {
                const a1 = molecule.atoms[bond.a1];
                const a2 = molecule.atoms[bond.a2];
                
                if (a1 && a2) {
                    ctx.beginPath();
                    const x1 = centerX + a1.x * scale;
                    const y1 = centerY + a1.y * scale;
                    const x2 = centerX + a2.x * scale;
                    const y2 = centerY + a2.y * scale;
                    
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                }
            });
            
            // 绘制原子
            molecule.atoms.forEach(atom => {
                const x = centerX + atom.x * scale;
                const y = centerY + atom.y * scale;
                const radius = 15;
                
                // 原子球体
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = atom.color;
                ctx.fill();
                
                // 原子边框
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#333';
                ctx.stroke();
                
                // 原子标签
                ctx.fillStyle = '#000';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(atom.type, x, y);
            });
            
            // 绘制坐标轴
            drawAxes(centerX, centerY, scale);
        }
        
        // 绘制坐标轴
        function drawAxes(centerX, centerY, scale) {
            const axisLength = 1.5 * scale;
            
            // z轴 (蓝色)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY - axisLength);
            ctx.strokeStyle = '#2196F3';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // x轴 (红色)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + axisLength, centerY);
            ctx.strokeStyle = '#F44336';
            ctx.stroke();
            
            // y轴 (绿色)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY + axisLength);
            ctx.strokeStyle = '#4CAF50';
            ctx.stroke();
            
            // 坐标轴标签
            ctx.fillStyle = '#F44336';
            ctx.fillText('x', centerX + axisLength + 10, centerY + 5);
            ctx.fillStyle = '#4CAF50';
            ctx.fillText('y', centerX - 10, centerY + axisLength + 15);
            ctx.fillStyle = '#2196F3';
            ctx.fillText('z', centerX - 10, centerY - axisLength - 10);
        }
        
        // 执行对称操作
        function performSymmetryOperation(operation, params = {}) {
            if (animationActive) return;
            
            const { axis = 'z', angle = 180, plane = 'xz' } = params;
            
            switch(operation) {
                case 'identity':
                    animateOperation(() => {
                        // 恒等操作，什么也不做
                        return molecule.atoms;
                    }, '恒等操作 (E)');
                    break;
                    
                case 'rotation':
                    const radAngle = (angle * Math.PI) / 180;
                    animateOperation(() => {
                        return rotateAtoms(axis, radAngle);
                    }, `旋转操作 C${360/angle} (${angle}°)`);
                    break;
                    
                case 'reflection':
                    animateOperation(() => {
                        return reflectAtoms(plane);
                    }, `反映操作 σ(${plane})`);
                    break;
                    
                case 'inversion':
                    animateOperation(() => {
                        return invertAtoms();
                    }, '反演操作 (i)');
                    break;
                    
                case 'improperRotation':
                    const angle2 = parseInt(document.getElementById('angle-select').value);
                    const radAngle2 = (angle2 * Math.PI) / 180;
                    animateOperation(() => {
                        const rotated = rotateAtoms(axis, radAngle2);
                        return reflectAtoms(plane, rotated);
                    }, `旋转反映操作 S${360/angle2}`);
                    break;
                    
                case 'all':
                    animateAllOperations();
                    break;
            }
        }
        
        // 旋转原子
        function rotateAtoms(axis, angle) {
            return molecule.atoms.map(atom => {
                const {x, y, z} = atom;
                let newX = x, newY = y, newZ = z;
                
                switch(axis) {
                    case 'x':
                        // 绕x轴旋转
                        newY = y * Math.cos(angle) - z * Math.sin(angle);
                        newZ = y * Math.sin(angle) + z * Math.cos(angle);
                        break;
                    case 'y':
                        // 绕y轴旋转
                        newX = x * Math.cos(angle) + z * Math.sin(angle);
                        newZ = -x * Math.sin(angle) + z * Math.cos(angle);
                        break;
                    case 'z':
                        // 绕z轴旋转
                        newX = x * Math.cos(angle) - y * Math.sin(angle);
                        newY = x * Math.sin(angle) + y * Math.cos(angle);
                        break;
                }
                
                return {...atom, x: newX, y: newY, z: newZ};
            });
        }
        
        // 反映原子
        function reflectAtoms(plane, atoms = molecule.atoms) {
            return atoms.map(atom => {
                const {x, y, z} = atom;
                let newX = x, newY = y, newZ = z;
                
                switch(plane) {
                    case 'xy': newZ = -z; break;  // 关于xy平面反映
                    case 'xz': newY = -y; break;  // 关于xz平面反映
                    case 'yz': newX = -x; break;  // 关于yz平面反映
                }
                
                return {...atom, x: newX, y: newY, z: newZ};
            });
        }
        
        // 反演原子
        function invertAtoms() {
            return molecule.atoms.map(atom => ({
                ...atom,
                x: -atom.x,
                y: -atom.y,
                z: -atom.z
            }));
        }
        
        // 动画执行操作
        function animateOperation(operationFunc, operationName) {
            if (animationActive) return;
            
            animationActive = true;
            const startAtoms = JSON.parse(JSON.stringify(molecule.atoms));
            const targetAtoms = operationFunc();
            const startTime = Date.now();
            const duration = 1500; // 动画持续时间(毫秒)
            
            // 显示操作名称
            showOperationInfo(operationName);
            
            function updateAnimation() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // 使用缓动函数使动画更平滑
                const easeProgress = easeInOutCubic(progress);
                
                // 插值原子位置
                molecule.atoms = startAtoms.map((atom, i) => {
                    const target = targetAtoms[i];
                    return {
                        ...atom,
                        x: atom.x + (target.x - atom.x) * easeProgress,
                        y: atom.y + (target.y - atom.y) * easeProgress,
                        z: atom.z + (target.z - atom.z) * easeProgress
                    };
                });
                
                drawMolecule();
                
                if (progress < 1) {
                    requestAnimationFrame(updateAnimation);
                } else {
                    // 动画结束后，确保位置精确
                    molecule.atoms = targetAtoms;
                    drawMolecule();
                    animationActive = false;
                    
                    // 短暂显示后恢复原始位置
                    setTimeout(() => {
                        resetToOriginal();
                    }, 1000);
                }
            }
            
            requestAnimationFrame(updateAnimation);
        }
        
        // 显示操作信息
        function showOperationInfo(operationName) {
            // 在画布上显示操作名称
            ctx.save();
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(10, 10, 300, 40);
            
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`对称操作: ${operationName}`, 20, 35);
            ctx.restore();
        }
        
        // 缓动函数
        function easeInOutCubic(t) {
            return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }
        
        // 动画执行所有对称操作
        function animateAllOperations() {
            if (animationActive) return;
            
            const group = pointGroups[currentGroup];
            if (!group) return;
            
            // 保存原始原子位置
            const savedAtoms = JSON.parse(JSON.stringify(molecule.atoms));
            
            // 根据点群执行不同的操作序列
            const operations = [];
            
            switch(currentGroup) {
                case 'C2v':
                    operations.push(
                        {type: 'identity', name: '恒等操作 (E)'},
                        {type: 'rotation', params: {angle: 180}, name: '旋转操作 C₂ (180°)'},
                        {type: 'reflection', params: {plane: 'xz'}, name: '反映操作 σᵥ(xz)'},
                        {type: 'reflection', params: {plane: 'yz'}, name: '反映操作 σᵥ\'(yz)'}
                    );
                    break;
                case 'C3v':
                    operations.push(
                        {type: 'identity', name: '恒等操作 (E)'},
                        {type: 'rotation', params: {angle: 120}, name: '旋转操作 C₃ (120°)'},
                        {type: 'rotation', params: {angle: 240}, name: '旋转操作 C₃² (240°)'},
                        {type: 'reflection', params: {plane: 'xz'}, name: '反映操作 σᵥ(1)'},
                        {type: 'reflection', params: {plane: 'xz', angle: 120}, name: '反映操作 σᵥ(2)'},
                        {type: 'reflection', params: {plane: 'xz', angle: 240}, name: '反映操作 σᵥ(3)'}
                    );
                    break;
                case 'Td':
                    operations.push(
                        {type: 'identity', name: '恒等操作 (E)'},
                        {type: 'rotation', params: {axis: 'x', angle: 180}, name: '旋转操作 C₂(x)'},
                        {type: 'rotation', params: {axis: 'y', angle: 180}, name: '旋转操作 C₂(y)'},
                        {type: 'rotation', params: {axis: 'z', angle: 120}, name: '旋转操作 C₃(111)'},
                        {type: 'reflection', params: {plane: 'xy'}, name: '反映操作 σ_d'}
                    );
                    break;
                default:
                    operations.push(
                        {type: 'identity', name: '恒等操作 (E)'},
                        {type: 'rotation', params: {angle: 180}, name: '旋转操作 C₂'},
                        {type: 'reflection', params: {plane: 'xz'}, name: '反映操作 σ'}
                    );
            }
            
            let currentOpIndex = 0;
            
            function executeNextOperation() {
                if (currentOpIndex >= operations.length) {
                    // 所有操作执行完毕，恢复原始位置
                    resetToOriginal();
                    return;
                }
                
                const op = operations[currentOpIndex];
                showOperationInfo(op.name);
                
                // 执行操作
                let newAtoms;
                switch(op.type) {
                    case 'identity':
                        newAtoms = JSON.parse(JSON.stringify(savedAtoms));
                        break;
                    case 'rotation':
                        const radAngle = ((op.params.angle || 180) * Math.PI) / 180;
                        newAtoms = rotateAtoms(op.params.axis || 'z', radAngle);
                        break;
                    case 'reflection':
                        newAtoms = reflectAtoms(op.params.plane || 'xz');
                        break;
                }
                
                // 动画过渡
                animateToAtoms(newAtoms, () => {
                    currentOpIndex++;
                    setTimeout(executeNextOperation, 800);
                });
            }
            
            executeNextOperation();
        }
        
        // 动画过渡到指定的原子位置
        function animateToAtoms(targetAtoms, callback) {
            if (animationActive) return;
            
            animationActive = true;
            const startAtoms = JSON.parse(JSON.stringify(molecule.atoms));
            const startTime = Date.now();
            const duration = 1200;
            
            function updateAnimation() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = easeInOutCubic(progress);
                
                // 插值原子位置
                molecule.atoms = startAtoms.map((atom, i) => {
                    const target = targetAtoms[i];
                    return {
                        ...atom,
                        x: atom.x + (target.x - atom.x) * easeProgress,
                        y: atom.y + (target.y - atom.y) * easeProgress,
                        z: atom.z + (target.z - atom.z) * easeProgress
                    };
                });
                
                drawMolecule();
                
                if (progress < 1) {
                    requestAnimationFrame(updateAnimation);
                } else {
                    molecule.atoms = targetAtoms;
                    drawMolecule();
                    animationActive = false;
                    if (callback) callback();
                }
            }
            
            requestAnimationFrame(updateAnimation);
        }
        
        // 重置到原始位置
        function resetToOriginal() {
            if (animationActive) return;
            
            animateToAtoms(originalAtoms, () => {
                // 重置完成后，可以执行其他操作
            });
        }
        
        // 事件监听器
        document.getElementById('identity-btn').addEventListener('click', () => {
            performSymmetryOperation('identity');
        });
        
        document.getElementById('rotation-btn').addEventListener('click', () => {
            const angle = parseInt(document.getElementById('angle-select').value);
            const axis = document.getElementById('axis-select').value;
            performSymmetryOperation('rotation', {angle, axis});
        });
        
        document.getElementById('reflection-btn').addEventListener('click', () => {
            const plane = document.getElementById('plane-select').value;
            performSymmetryOperation('reflection', {plane});
        });
        
        document.getElementById('inversion-btn').addEventListener('click', () => {
            performSymmetryOperation('inversion');
        });
        
        document.getElementById('improper-rotation-btn').addEventListener('click', () => {
            performSymmetryOperation('improperRotation');
        });
        
        document.getElementById('animate-all-btn').addEventListener('click', () => {
            performSymmetryOperation('all');
        });
        
        document.getElementById('reset-btn').addEventListener('click', () => {
            resetToOriginal();
        });
        
        document.getElementById('point-group-select').addEventListener('change', (e) => {
            initMolecule(e.target.value);
        });
        
        // 点群卡片点击事件
        document.querySelectorAll('.point-group-card').forEach(card => {
            card.addEventListener('click', () => {
                const groupId = card.dataset.group;
                initMolecule(groupId);
            });
        });
        
        // 初始化
        initMolecule('C2v');
        
        // 绘制初始分子
        drawMolecule();
    </script>
</body>
</html>